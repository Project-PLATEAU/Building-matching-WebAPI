version: "3.9"

services:
  pgdb:
    container_name: pgdb
    image: postgis/postgis:15-3.3-alpine
    volumes:
      - type: volume
        source: pgdb_data
        target: /var/lib/postgresql/data/
      - type: bind
        source: ./initdb.d
        target: /docker-entrypoint-initdb.d/
    env_file:
      - ./docker.env
    ports:
      - 5432:5432

  webapi:
    container_name: webapi
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - ./docker.env
    volumes:
      - type: bind
        source: ./app
        target: /app/app
    ports:
      - 5000:5000

  service_pgadmin:
    image: dpage/pgadmin4:6.11
    container_name: container_pgadmin_postgis
    ports:
      - 8080:80
    volumes:
      - volume_pgadmin:/var/lib/pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: example@example.com # TODO: dotenvの設定
      PGADMIN_DEFAULT_PASSWORD: password # TODO: dotenvの設定
    depends_on:
      - pgdb

volumes:
  pgdb_data: {}
  volume_pgadmin:
    name: vpga
