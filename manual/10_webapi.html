<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>WebAPI仕様 </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="WebAPI仕様 ">
    
      <link rel="shortcut icon" href="../favicon.ico">
      <link rel="stylesheet" href="../styles/docfx.vendor.css">
      <link rel="stylesheet" href="../styles/docfx.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">


<p>このページでは WebAPI の仕様を説明します。</p>
<ul>
<li><a href="#2d">2D 建物マッチング機能</a></li>
<li><a href="#3d_pointcloud">3D 点群マッチング機能</a></li>
<li><a href="#3d_texture">3D テクスチャマッピング機能</a></li>
</ul>
<h2 id="2d-建物マッチング機能"><a name="2d">2D 建物マッチング機能</a></h2>
<ul>
<li><p>機能概要</p>
<p>GeoJSON ポリゴンで表現された 2D 建物データを問い合わせとして送信すると、
対応する 3D都市モデルの建物データを GeoJSON 形式で返します。</p>
</li>
<li><p>API 詳細</p>
<ul>
<li><p>リクエスト</p>
<ul>
<li>エンドポイント: <code>/api/building2d</code></li>
<li>HTTP メソッド: POST</li>
<li>パラメータ: なし</li>
<li>リクエストボディ: 問い合わせ 2D ポリゴン
<ul>
<li><p>Content-type: &quot;application/json&quot;</p>
</li>
<li><p>書式: <a href="https://www.geojson.org/">GeoJSON</a>
(Polygon, MultiPolygon, Feature, FeatureCollection)</p>
</li>
<li><p>サンプル</p>
<pre><code>  {
    &quot;type&quot;: &quot;Feature&quot;,
    &quot;properties&quot;: {
      &quot;fid&quot;: 64222,
      &quot;id&quot;: &quot;004241081F01C8013504000000000000&quot;,
      &quot;olc&quot;: &quot;8Q7W4RG2+J2J&quot;,
      &quot;area&quot;: &quot;320.6021978445351&quot;
    },
    &quot;geometry&quot;: {
      &quot;type&quot;: &quot;Polygon&quot;,
      &quot;coordinates&quot;: [[
        [138.79995583, 35.1266925],
        [138.80014306, 35.12663333],
        [138.80007472, 35.12648583],
        [138.79988722, 35.12654472],
        [138.79995583, 35.1266925]
      ]]
    }
  }
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>レスポンス</p>
<ul>
<li><p>HTTP Status Code: 200 (Success)</p>
<ul>
<li><p>Content-type: &quot;application/json&quot;</p>
</li>
<li><p>書式: <a href="https://www.geojson.org/">GeoJSON</a> FeatureCollection</p>
<ul>
<li>各 Feature の &quot;type&quot; は &quot;Polygon&quot; になります。</li>
<li>&quot;coordinates&quot; にはリクエストのポリゴンではなく、
マッチした 3D都市モデルの建物データの座標が入ります。</li>
<li>リクエストが &quot;Feature&quot; の場合、&quot;properties&quot; の値は
レスポンスの Feature の &quot;properties&quot; に引き継がれます。</li>
<li>レスポンスの Feature の &quot;peoperties&quot; には、
以下の値が追加されます。
<ul>
<li>&quot;plateau_bldid&quot;: 3D都市モデルの建物データ ID</li>
<li>&quot;plateau_area&quot;: 3D都市モデルの建物データの面積（㎡）</li>
<li>&quot;intersection_area&quot;: リクエストのポリゴンと交差した
部分の面積（㎡）</li>
<li>&quot;source_area&quot;: リクエストのポリゴンの面積（㎡）</li>
<li>&quot;area_ratio&quot;: 3D都市モデルの建物データの面積に対する
交差した部分の面積の比率。</li>
<li>&quot;dist&quot;: リクエストのポリゴンと 3D都市モデルの建物データの
重心間の距離（ｍ）</li>
<li>&quot;confidence&quot;: 一致判定の確信度。 &quot;high&quot; または &quot;low&quot;。</li>
</ul>
</li>
</ul>
</li>
<li><p>サンプル</p>
<pre><code>  {
    &quot;type&quot;: &quot;FeatureCollection&quot;,
    &quot;features&quot;: [
      {
        &quot;type&quot;: &quot;Feature&quot;,
        &quot;geometry&quot;: {
          &quot;type&quot;: &quot;Polygon&quot;,
          &quot;coordinates&quot;: [[
              [138.799867954412, 35.1265309012756],
              [138.800015901042, 35.1264820371127],
              [138.800083779088, 35.126620602316],
              [138.799935832579, 35.1266695567059],
              [138.799867954412, 35.1265309012756]
          ]]
        },
        &quot;properties&quot;: {
          &quot;fid&quot;: 64222,
          &quot;id&quot;: &quot;004241081F01C8013504000000000000&quot;,
          &quot;olc&quot;: &quot;8Q7W4RG2+J2J&quot;,
          &quot;area&quot;: &quot;320.6021978445351&quot;,
          &quot;plateau_bldid&quot;: &quot;22203-bldg-22489&quot;,
          &quot;plateau_area&quot;: 240.9401,
          &quot;intersection_area&quot;: 195.7563,
          &quot;source_area&quot;: 320.6022,
          &quot;area_ratio&quot;: 0.75,
          &quot;dist&quot;: 3.88,
          &quot;confidence&quot;: &quot;high&quot;
        }
      }
    ]
  }
</code></pre>
</li>
</ul>
</li>
<li><p>HTTP Status Code: 400 (Bad Request)</p>
<ul>
<li>リクエストパラメータの解析に失敗した場合、または
対応していないフォーマットの場合。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3d-点群マッチング機能"><a name="3d_pointcloud">3D 点群マッチング機能</a></h2>
<ul>
<li><p>機能概要</p>
<p>3D 点群データを問い合わせデータとして送信すると、その点群に
対応する 3D都市モデルの建物データのリストと、点群がそれぞれの建物表面を
カバーする面積を 2D GeoJSON 形式で返します。</p>
</li>
<li><p>API 詳細</p>
<ul>
<li><p>リクエスト</p>
<ul>
<li>エンドポイント: <code>/api/pointcloud3d</code></li>
<li>HTTP メソッド: POST</li>
<li>パラメータ: なし</li>
<li>リクエストボディ: 3D 点群 LAS ファイルを含むマルチパートフォームデータ
<ul>
<li><p>Content-type: &quot;multipart/form-data&quot;</p>
<ul>
<li>ファイルパート
<ul>
<li>file (必須): バイナリデータ (application/octet-stream)</li>
</ul>
</li>
<li>その他のフォームデータ
<ul>
<li>srid: LAS ファイルの空間参照系ID (整数値)、ただし
処理可能な値は JGD2011 の平面直角座標系1系の
6669 から19系の 6687 までです。デフォルトは 6676 です。</li>
</ul>
</li>
</ul>
</li>
<li><p>サンプル</p>
<pre><code>  （バイナリデータのため省略）
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>レスポンス</p>
<ul>
<li><p>HTTP Status Code: 200 (Success)</p>
<ul>
<li><p>Content-type: &quot;application/json&quot;</p>
</li>
<li><p>書式: <a href="https://www.geojson.org/">GeoJSON</a> FeatureCollection</p>
<ul>
<li>各 Feature の &quot;type&quot; は &quot;Polygon&quot; になります。</li>
<li>&quot;coordinates&quot; にはマッチした 3D都市モデルの建物データの座標が入ります。</li>
<li>レスポンスの Feature の &quot;peoperties&quot; には、
以下の値が追加されます。
<ul>
<li>&quot;plateau_bldid&quot;: 3D都市モデルの建物データ ID</li>
<li>&quot;plateau_area&quot;: 3D都市モデルの建物データの面積（㎡）</li>
<li>&quot;num_points_in_region&quot;: この建物の領域（床面を1m拡大した
土地から垂直に延びる柱状）内に存在する、点群から生成した
1m グリッド上の点の数</li>
<li>&quot;num_point_near_wall&quot;: この建物の表面（壁面と屋上）から
1m 以内に存在する、点群から生成した 1m グリッド上の点の数</li>
<li>&quot;area&quot;: この建物の表面積（㎡）</li>
</ul>
</li>
</ul>
</li>
<li><p>サンプル</p>
<pre><code>  {
    &quot;type&quot;: &quot;FeatureCollection&quot;,
    &quot;features&quot;: [
      {
        &quot;type&quot;: &quot;Feature&quot;,
        &quot;geometry&quot;: {
          &quot;type&quot;: &quot;Polygon&quot;,
          &quot;coordinates&quot;: [[
            [[138.858442678109,35.105507117857]],
            [[138.858482801685,35.1055035069966]],
            [[138.858486923358,35.1055344254259]],
            [[138.858495643877,35.1055293713408]],
            [[138.858496420089,35.1055287731858]],
            [[138.858532374915,35.1055020325634]],
            [[138.858670333762,35.1054908918083]],
            [[138.858677167083,35.1055480858408]],
            [[138.85860737183,35.1055531078681]],
            [[138.858607429441,35.105553738714]],
            [[138.858505882623,35.1055604041942]],
            [[138.858504698293,35.1055604888271]],
            [[138.858500028791,35.1055620360049]],
            [[138.858491751617,35.1055601169505]],
            [[138.858490168329,35.1055587739618]],
            [[138.858490476815,35.1055610843722]],
            [[138.858450367822,35.1055647754213]],
            [[138.858442678109,35.105507117857]]
          ]]
        },
        &quot;properties&quot;: {
          &quot;plateau_bldid&quot;: &quot;22203-bldg-115256&quot;,
          &quot;num_points_in_region&quot;: 706,
          &quot;num_points_near_wall&quot;: 485,
          &quot;area&quot;: 1237.93
        }
      },
      （繰り返し省略）
      {
        &quot;type&quot;: &quot;Feature&quot;,
        &quot;geometry&quot;: {
          &quot;type&quot;: &quot;Polygon&quot;,
          &quot;coordinates&quot;: [[
            [[138.858450367822,35.1055647754213]],
            [[138.858489248363,35.1055613638489]],
            [[138.858499512984,35.1056378874932]],
            [[138.858501698734,35.1056548166058]],
            [[138.858513881592,35.1056538538869]],
            [[138.858670342922,35.1056402172829]],
            [[138.858719858998,35.1056359448354]],
            [[138.858729174938,35.105706949873]],
            [[138.858740061578,35.105706071196]],
            [[138.858744862435,35.1057430129095]],
            [[138.858733359887,35.10574402412]],
            [[138.85873579043,35.1057627337725]],
            [[138.858680114376,35.1057676338329]],
            [[138.858679609208,35.1057637473657]],
            [[138.858673330496,35.105764297798]],
            [[138.858673716845,35.1057673534782]],
            [[138.858580790716,35.105775529591]],
            [[138.858582990884,35.1057969983705]],
            [[138.858550757812,35.1057996745606]],
            [[138.858475247813,35.1057514646533]],
            [[138.858450367822,35.1055647754213]]
          ]]
        },
        &quot;properties&quot;: {
          &quot;plateau_bldid&quot;: &quot;22203-bldg-97160&quot;,
          &quot;num_points_in_region&quot;: 1411,
          &quot;num_points_near_wall&quot;: 967,
          &quot;area&quot;: 1938.33
        }
      }
    ]
  }
</code></pre>
</li>
<li><p>補足：カバー率の計算
&quot;num_points_in_region&quot;, &quot;num_points_near_wall&quot; は
1m グリッドにダウンサンプリングした点を数えているため、
建物表面上を点群がカバーしているおおよその面積を表します。</p>
<p>上記の例の最初のポリゴンでは、 &quot;num_points_near_wall&quot; が 485,
&quot;area&quot; が 1237.93 なので、建物表面全体の約 39%
(485 / 1237.94 = 0.3934) を点群がカバーしていると計算できます。</p>
</li>
</ul>
</li>
<li><p>HTTP Status Code: 400 (Bad Request)</p>
<ul>
<li>対応していないファイルフォーマットの場合。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3d-テクスチャマッピング機能"><a name="3d_texture">3D テクスチャマッピング機能</a></h2>
<ul>
<li><p>機能概要</p>
<p>3D 点群データと 3D都市モデルの建物データ ID を問い合わせデータとして送信すると、
その建物に点群データから生成したテクスチャをマッピングした
3D都市モデルを Wavefront OBJ 形式で返します。</p>
</li>
<li><p>API 詳細</p>
<ul>
<li><p>リクエスト</p>
<ul>
<li>エンドポイント: <code>/api/mapping3d</code></li>
<li>HTTP メソッド: POST</li>
<li>パラメータ: なし</li>
<li>リクエストボディ: 3D 点群 LAS ファイルを含むマルチパートフォームデータ
<ul>
<li><p>Content-type: &quot;multipart/form-data&quot;</p>
<ul>
<li>ファイルパート
<ul>
<li>file (必須): バイナリデータ (application/octet-stream)</li>
</ul>
</li>
<li>その他のフォームデータ
<ul>
<li>bldid (必須): 対象とする 3D都市モデルの建物データの ID (文字列)。</li>
<li>srid: LAS ファイルの空間参照系ID (整数値)、ただし
処理可能な値は JGD2011 の平面直角座標系1系の
6669 から19系の 6687 までです。デフォルトは 6676 です。</li>
<li>imagesize: 生成するテクスチャ画像の長辺ピクセル数
（整数値）。デフォルトは 512 です。</li>
<li>method: テクスチャマッピングの手法を選択します。
デフォルトは &quot;smart&quot; です。
<ul>
<li>&quot;all&quot;: 全ての点群を全ての壁面に投影します。</li>
<li>&quot;nearest&quot;: 全ての点群を最寄りの壁面に投影します。</li>
<li>&quot;smart&quot;: 壁面ごとに自動的に計算されるしきい値よりも
近い点群を投影します。</li>
</ul>
</li>
<li>lod: 3D都市モデルの LoD （整数値）を指定します。
デフォルトは 1 です。</li>
<li>limit: 点群の点の数の上限値を指定します。
アップロードされたファイルにこの値以上の点が含まれて
いる場合は、指定された値までダウンサンプリングします。
値は整数値、または &quot;k&quot;, &quot;m&quot; を付けた文字列で指定します。
&quot;100k&quot; は10万を意味します。</li>
</ul>
</li>
</ul>
</li>
<li><p>サンプル</p>
<pre><code>  （バイナリデータのため省略）
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>レスポンス</p>
<ul>
<li><p>HTTP Status Code: 200 (Success)</p>
<ul>
<li><p>Content-type: &quot;application/zip&quot;</p>
</li>
<li><p>書式: Zip ファイル</p>
<ul>
<li>推奨ファイル名は Content-Disposition ヘッダの
”attachment; filename&quot; に記載されますが、任意です。</li>
<li>Zip ファイルには&quot;coordinates&quot; には以下のファイルが含まれます。
<ul>
<li><code>{bldid}_lod{lod}_{method}_{点の数}.obj</code>:
3D都市モデルの頂点座標や辺、面を構成する集合、
各面に割り当てるリソース名などを含みます。</li>
<li><code>{bldid}_lod{lod}_{method}_{点の数}.mtl</code>:
リソース名に対応する画像ファイル名などの情報を含みます。</li>
<li><code>{bldid}_lod{lod}_{method}_{点の数}_{壁面番号}.png</code>:
壁面のテクスチャ画像です。</li>
<li><code>no_texture.png</code>: テクスチャ情報が存在しない場合の画像です。</li>
</ul>
</li>
</ul>
</li>
<li><p>サンプル</p>
<pre><code>  （バイナリデータのため省略）
</code></pre>
</li>
<li><p>補足：カバー率の計算
&quot;num_points_in_region&quot;, &quot;num_points_near_wall&quot; は
1m グリッドにダウンサンプリングした点を数えているため、
建物表面上を点群がカバーしているおおよその面積を表します。</p>
<p>上記の例の最初のポリゴンでは、 &quot;num_points_near_wall&quot; が 485,
&quot;area&quot; が 1237.93 なので、建物表面全体の約 39%
(485 / 1237.94 = 0.3934) を点群がカバーしていると計算できます。</p>
</li>
</ul>
</li>
<li><p>HTTP Status Code: 400 (Bad Request)</p>
<ul>
<li>対応していないファイルフォーマットの場合。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
